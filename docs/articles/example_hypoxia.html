<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hypoxia Details • untidydata2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Hypoxia Details">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">untidydata2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example_hypoxia.html">Hypoxia Details</a>
    </li>
    <li>
      <a href="../articles/gdp_by_county.html">U.S. GDP</a>
    </li>
    <li>
      <a href="../articles/journal_cost.html">Cost of publishing in journals</a>
    </li>
    <li>
      <a href="../articles/multievent.html">Preparing multiple event data for analysis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Hypoxia Details</h1>
                        <h4 class="author">Giorgi Chighladze</h4>
            
            <h4 class="date">2019-04-16</h4>
      
      
      <div class="hidden name"><code>example_hypoxia.Rmd</code></div>

    </div>

    
    
<p>Data do not always come in a format that you can readily use for analysis. Some cleaning and restructuring of data is often needed despite of the size of the dataset.</p>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>This <a href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2018/2018-09-18">data</a> was downloaded 15 Apr 2019 from <a href="https://github.com/rfordatascience/tidytuesday">TidyTuesday</a>.</p>
<p>NEED SOME DESCRIPTION OF THE DATA and PROBLEMS IT HAS…</p>
<p>Before looking at the data, make sure that we do not missinterpret any entry when reading the file. For csv and txt files it is safe to read each columns as text. Also, it is good practice to read only the first few rows (5 in this case) of data for this purpose.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">datfile &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"messydata"</span>, <span class="st">"hypoxia.csv"</span>, <span class="dt">package=</span><span class="st">"untidydata2"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">read_csv</span>(datfile, <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">.default =</span> <span class="st">"c"</span>), <span class="dt">n_max =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">X1</th>
<th align="left">Altitude</th>
<th align="left">Air press</th>
<th align="left">ppO2</th>
<th align="left">Alv pO2</th>
<th align="left">% sat O2</th>
<th align="left">Alv pCO2</th>
<th align="left">Alv pO2 with O2=100%</th>
<th align="left">% sat O2_1</th>
<th align="left">Alv pCO2_1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">Ft/m</td>
<td align="left">mmHg</td>
<td align="left">Air=21%</td>
<td align="left">mmHg on air</td>
<td align="left">&gt;90% desired</td>
<td align="left">&gt;35 best</td>
<td align="left">NA</td>
<td align="left">100% O2</td>
<td align="left">100% O2</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">Sea level</td>
<td align="left">760</td>
<td align="left">159</td>
<td align="left">104</td>
<td align="left">97</td>
<td align="left">40</td>
<td align="left">673</td>
<td align="left">100</td>
<td align="left">40</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">10k/3k</td>
<td align="left">523</td>
<td align="left">110</td>
<td align="left">67</td>
<td align="left">90</td>
<td align="left">36</td>
<td align="left">436</td>
<td align="left">100</td>
<td align="left">40</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">20k/6.1k</td>
<td align="left">349</td>
<td align="left">73</td>
<td align="left">40</td>
<td align="left">73</td>
<td align="left">24</td>
<td align="left">262</td>
<td align="left">100</td>
<td align="left">40</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">30k/9.1k</td>
<td align="left">226</td>
<td align="left">47</td>
<td align="left">18</td>
<td align="left">24</td>
<td align="left">24</td>
<td align="left">139</td>
<td align="left">99</td>
<td align="left">40</td>
</tr>
</tbody>
</table>
</div>
<div id="problems" class="section level2">
<h2 class="hasAnchor">
<a href="#problems" class="anchor"></a>Problems</h2>
<p>There are several problems that one can note at first glance.</p>
<ul>
<li>variable description is included in the first row</li>
<li>column names contain spaces and symbols</li>
<li>first column is redandant and inaccurate (first row is assigned 1, even though it does not represent an observation)</li>
<li>variable ‘Altitude’ contains two values in different units and non-numeric record (‘Sea level’)</li>
<li>last three variables are the same as previous 3 columns, but at different oxygen content (percentge)</li>
</ul>
</div>
<div id="tidying-data" class="section level2">
<h2 class="hasAnchor">
<a href="#tidying-data" class="anchor"></a>Tidying Data</h2>
<p>First we need to fix the variable names. The best way is to manually define each variable name after reading the data without column names. Since the last 6 columns represent the same variable measured at different oxygen levels, we will incorporate this piece of info in the variable names (and use later when reshaping the data).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(datfile, </a>
<a class="sourceLine" id="cb2-2" data-line-number="2">                 <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">.default =</span> <span class="st">"?"</span>), </a>
<a class="sourceLine" id="cb2-3" data-line-number="3">                 <span class="dt">col_names =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">                 <span class="dt">skip =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">  </span><span class="co"># remove first cloumn </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="st">  </span><span class="co"># set names of variables </span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'altitude'</span>, <span class="st">'air_pressure'</span>, <span class="st">'ppO2'</span>, </a>
<a class="sourceLine" id="cb2-9" data-line-number="9">              <span class="st">'alveoli_pO2-21'</span>, <span class="st">'sturation_O2-21'</span>, <span class="st">'alveoli_pCO2-21'</span>,</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">              <span class="st">'alveoli_pO2-100'</span>, <span class="st">'sturation_O2-100'</span>, <span class="st">'alveoli_pCO2-100'</span>))</a></code></pre></div>
<p>After reading the data we will address remaining problems listed as follow:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">tidy_data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">  </span><span class="co"># set 'Sea level' as 0 ft and 0 m in format matching the other records in altitude</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">altitude =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(altitude <span class="op">==</span><span class="st"> 'Sea level'</span>, <span class="st">'0k/0k'</span>, altitude)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  </span><span class="co"># split altitude data into columns corresponding to each unit of measurement</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="st">  </span><span class="kw">separate</span>(altitude, <span class="dt">into =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'altitude_ft'</span>, <span class="st">'altitude_m'</span>), <span class="dt">sep =</span> <span class="st">'/'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="st">  </span><span class="co"># convert altitude into numeric data by taking into account k</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">'altitude'</span>)), parse_number) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">'altitude'</span>)), <span class="kw">funs</span>(. <span class="op">*</span><span class="st"> </span><span class="dv">1000</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="st">  </span><span class="co"># handle last 6 columns</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="st">  </span><span class="kw">gather</span>(key, value, <span class="dv">5</span><span class="op">:</span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="st">  </span><span class="co"># extract oxygen level (that was incorporated into the variable name earlier)</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="st">  </span><span class="kw">separate</span>(key, <span class="dt">into =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'variable'</span>, <span class="st">'O2'</span>), <span class="dt">sep =</span> <span class="st">'-'</span>, <span class="dt">convert =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="st">  </span><span class="kw">spread</span>(variable, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="st">  </span><span class="kw">arrange</span>(O2, altitude_ft)</a></code></pre></div>
<pre><code>## Warning: funs() is soft deprecated as of dplyr 0.8.0
## please use list() instead
## 
## # Before:
## funs(name = f(.)
## 
## # After: 
## list(name = ~f(.))
## This warning is displayed once per session.</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(tidy_data)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">altitude_ft</th>
<th align="right">altitude_m</th>
<th align="right">air_pressure</th>
<th align="right">ppO2</th>
<th align="right">O2</th>
<th align="right">alveoli_pCO2</th>
<th align="right">alveoli_pO2</th>
<th align="right">sturation_O2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">760</td>
<td align="right">159</td>
<td align="right">21</td>
<td align="right">40</td>
<td align="right">104</td>
<td align="right">97</td>
</tr>
<tr class="even">
<td align="right">10000</td>
<td align="right">3000</td>
<td align="right">523</td>
<td align="right">110</td>
<td align="right">21</td>
<td align="right">36</td>
<td align="right">67</td>
<td align="right">90</td>
</tr>
<tr class="odd">
<td align="right">20000</td>
<td align="right">6100</td>
<td align="right">349</td>
<td align="right">73</td>
<td align="right">21</td>
<td align="right">24</td>
<td align="right">40</td>
<td align="right">73</td>
</tr>
<tr class="even">
<td align="right">30000</td>
<td align="right">9100</td>
<td align="right">226</td>
<td align="right">47</td>
<td align="right">21</td>
<td align="right">24</td>
<td align="right">18</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="right">40000</td>
<td align="right">12000</td>
<td align="right">141</td>
<td align="right">29</td>
<td align="right">21</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">50000</td>
<td align="right">15200</td>
<td align="right">87</td>
<td align="right">18</td>
<td align="right">21</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">760</td>
<td align="right">159</td>
<td align="right">100</td>
<td align="right">40</td>
<td align="right">673</td>
<td align="right">100</td>
</tr>
<tr class="even">
<td align="right">10000</td>
<td align="right">3000</td>
<td align="right">523</td>
<td align="right">110</td>
<td align="right">100</td>
<td align="right">40</td>
<td align="right">436</td>
<td align="right">100</td>
</tr>
<tr class="odd">
<td align="right">20000</td>
<td align="right">6100</td>
<td align="right">349</td>
<td align="right">73</td>
<td align="right">100</td>
<td align="right">40</td>
<td align="right">262</td>
<td align="right">100</td>
</tr>
<tr class="even">
<td align="right">30000</td>
<td align="right">9100</td>
<td align="right">226</td>
<td align="right">47</td>
<td align="right">100</td>
<td align="right">40</td>
<td align="right">139</td>
<td align="right">99</td>
</tr>
<tr class="odd">
<td align="right">40000</td>
<td align="right">12000</td>
<td align="right">141</td>
<td align="right">29</td>
<td align="right">100</td>
<td align="right">36</td>
<td align="right">58</td>
<td align="right">84</td>
</tr>
<tr class="even">
<td align="right">50000</td>
<td align="right">15200</td>
<td align="right">87</td>
<td align="right">18</td>
<td align="right">100</td>
<td align="right">24</td>
<td align="right">16</td>
<td align="right">15</td>
</tr>
</tbody>
</table>
</div>
<div id="figures" class="section level2">
<h2 class="hasAnchor">
<a href="#figures" class="anchor"></a>Figures</h2>
<p>Lets plot the data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">tidy_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">O2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(O2, <span class="dt">levels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">21</span>, <span class="dv">100</span>), <span class="dt">labels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'21%'</span>, <span class="st">'100%'</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> alveoli_pO2, <span class="dt">y =</span> altitude_m)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> O2), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_light</span>()</a></code></pre></div>
<p><img src="example_hypoxia_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data">Data</a></li>
      <li><a href="#problems">Problems</a></li>
      <li><a href="#tidying-data">Tidying Data</a></li>
      <li><a href="#figures">Figures</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Anne Eaton, Giorgi Chighladze, Kevin Wright.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
